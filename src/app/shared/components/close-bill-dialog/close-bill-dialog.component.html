<div class="dialog-container p-3">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="dialog-header m-0">{{ "CLOSE_BILL" | translate }} ğŸ’³</h2>
    <button mat-icon-button color="warn" (click)="onClose()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Product Bills Table -->
  <div
    class="product-bills-section mb-3"
    *ngIf="data.product_bills_set && data.product_bills_set.length > 0"
  >
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h6 class="m-0">ğŸ›ï¸</h6>
      <button
        *ngIf="data.product_bills_set.length > 3"
        (click)="toggleProductBills()"
        class="expand-emoji-btn"
      >
        {{ isProductBillsExpanded ? "ğŸ”¼" : "ğŸ”½" }}
      </button>
    </div>

    <div class="table-responsive" [class.expanded]="isProductBillsExpanded">
      <table class="table table-sm table-striped">
        <thead>
          <tr>
            <th>{{ "PRODUCTS" | translate }}</th>
            <th>{{ "QUANTITY" | translate }}</th>
            <th>{{ "PRICE" | translate }}</th>
            <th>{{ "TOTAL" | translate }}</th>
          </tr>
        </thead>
        <tbody class="table-body-transition">
          <tr
            *ngFor="let bill of data.product_bills_set; let i = index"
            [class.hidden-row]="!isProductBillsExpanded && i >= 3"
            [style.animation-delay]="i * 0.1 + 's'"
          >
            <td>{{ bill.name }}</td>
            <td>{{ bill.quantity }}</td>
            <td>{{ bill.unit_price }} EGP</td>
            <td>{{ bill.total_price }} EGP</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="text-center my-3">
    <h5>{{ "TOTAL_PRICE" | translate }}: {{ data.total_price }} EGP</h5>
  </div>

  <div class="text-center mb-3">
    <h5>
      {{ "SPENT_TIME" | translate }}:
      {{ getSpentTimeFormatted(data.spent_time) }}
    </h5>
  </div>

  <!-- Dialog Body -->
  <div class="dialog-body" [formGroup]="form">
    <div class="row g-3">
      <!-- Instapay -->
      <div class="col-md-4">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>InstapayğŸ“²</mat-label>
          <input
            type="number"
            matInput
            formControlName="instapay"
            (input)="updateRest()"
          />
        </mat-form-field>
      </div>
      <!-- Cash -->
      <div class="col-md-4">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>CashğŸ’µ</mat-label>
          <input
            type="number"
            matInput
            formControlName="cash"
            (input)="updateRest()"
          />
        </mat-form-field>
      </div>
      <!-- Visa -->
      <div class="col-md-4">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>VisağŸ’³</mat-label>
          <input
            type="number"
            matInput
            formControlName="visa"
            (input)="updateRest()"
          />
        </mat-form-field>
      </div>
    </div>
    <!-- Rest display -->
    <div class="text-center mt-3">
      <h5 [ngStyle]="{ color: rest >= 0 ? 'green' : 'red' }">
        {{ "REMAINING" | translate }}: {{ rest }} EGP
      </h5>
    </div>
  </div>

  <!-- Footer -->
  <mat-dialog-actions
    align="end"
    class="d-flex justify-content-between align-items-center m-3 dialog-footer"
  >
    <button mat-button color="warn" (click)="onClose()">
      {{ "CANCEL" | translate }}
    </button>
    <button
      mat-raised-button
      color="primary"
      [disabled]="rest != 0"
      (click)="submit()"
    >
      {{ "SUBMIT" | translate }}
    </button>
  </mat-dialog-actions>
</div>
