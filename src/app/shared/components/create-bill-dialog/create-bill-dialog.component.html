<div class="dialog-container p-3">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="dialog-header m-0">üßí {{ "CREATE_BILL" | translate }}</h2>
    <button mat-icon-button color="warn" (click)="onClose()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Selected Children Display with Ages -->
  <!-- Selected Children Display with Ages - Compact Version -->
  <div
    *ngIf="selectedChildren.length > 0"
    class="selected-children-compact mb-3"
  >
    <div class="selected-children-chips">
      <mat-chip
        *ngFor="let child of selectedChildren"
        class="child-chip"
        [removable]="true"
        (removed)="removeChild(child.id)"
      >
        <span class="child-name-compact">{{ child.name }}</span>
        <span
          class="child-age-highlight"
          [class.age-under-two]="isChildUnderTwoYears(child.id)"
        >
          {{ getChildAgeById(child.id) }}
        </span>
        <mat-icon matChipRemove>cancel</mat-icon>
      </mat-chip>
    </div>
  </div>

  <!-- Body -->
  <div class="dialog-body">
    <!-- Existing Children Multi-select -->
    <mat-form-field style="width: 100%" appearance="outline">
      <mat-label>{{ label }}</mat-label>

      <mat-select [formControl]="childrenControl" multiple>
        <!-- Custom trigger to show selected children -->
        <mat-select-trigger>
          <div
            *ngIf="selectedChildIds.length === 0; else selectedContent"
            class="placeholder-text"
          >
            {{ "CHOOSE_CHILDREN_PLACEHOLDER" | translate }}
          </div>
          <ng-template #selectedContent>
            <div class="selected-children-display">
              <mat-chip
                *ngFor="let id of selectedChildIds.slice(0, 2)"
                class="selected-chip"
                [removable]="true"
                (removed)="removeChild(id)"
              >
                {{ getChildNameById(id) }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <span
                *ngIf="selectedChildIds.length > 2"
                class="additional-count"
              >
                +{{ selectedChildIds.length - 2 }}
                {{ "MORE_SELECTED" | translate }}
              </span>
            </div>
          </ng-template>
        </mat-select-trigger>

        <!-- Search Field -->
        <mat-form-field style="width: 100%" appearance="outline">
          <mat-label>üîç {{ "SEARCH_CHILD" | translate }}</mat-label>
          <input
            matInput
            [(ngModel)]="searchValue"
            (input)="onSearchInput($event)"
            (keydown)="onSearchKeydown($event)"
            (click)="$event.stopPropagation()"
            [placeholder]="'SEARCH_CHILD' | translate"
          />
          <button
            *ngIf="searchValue"
            style="position: absolute; left: -10px; top: 5px"
            mat-icon-button
            (click)="clearFilter(); $event.stopPropagation()"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <!-- Children Options -->
        <mat-option
          [value]="''"
          style="display: none"
          [disabled]="true"
          class="no-checkbox"
        >
          {{ "" }}
        </mat-option>
        <mat-option *ngFor="let child of filteredChildren" [value]="child.id">
          {{ child.name }}
        </mat-option>
        <!-- No Results Message -->
        <div
          *ngIf="filteredChildren.length === 0"
          style="padding: 16px; text-align: center; color: #666"
        >
          üòî {{ "NO_RESULTS" | translate }}
        </div>
      </mat-select>
    </mat-form-field>

    <!-- Rest of your form content remains the same -->
    <!--promo code  -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>{{ "PROMO_CODE" | translate }}</mat-label>
      <input
        matInput
        placeholder="{{ 'ENTER_PROMO_CODE' | translate }}"
        [formControl]="discount"
      />
      <mat-icon matSuffix>local_offer</mat-icon>
    </mat-form-field>

    <!-- Add New Child Button -->
    <div class="mb-3">
      <button mat-raised-button color="primary" (click)="addNewChild()">
        <mat-icon>add</mat-icon>
        üë∂ {{ "CREATE_NEW_CHILD" | translate }}
      </button>
    </div>

    <!-- Dynamic Child Form Array with Horizontal Layout -->
    <!-- ... rest of your existing form code ... -->
  </div>

  <!-- Footer -->
  <mat-dialog-actions
    align="end"
    class="d-flex justify-content-between align-items-center m-3 dialog-footer"
  >
    <button mat-button color="warn" (click)="onClose()">
      {{ "CANCEL" | translate }}
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="form.invalid && newChildren.length > 0"
    >
      {{ "SAVE" | translate }}
    </button>
  </mat-dialog-actions>
</div>
